## 문제 1
from PIL import Image, ImageOps
import numpy as np

def crop(image, coordinates):
    """
    이미지를 잘라내는 함수
    :param image: PIL 이미지 객체
    :param coordinates: (좌측 상단 x, y, 우측 하단 x, y) 튜플
    :return: 잘라낸 이미지
    """
    return image.crop(coordinates)

def rotate(image, angle, expand=True):
    """
    이미지를 회전시키는 함수
    :param image: PIL 이미지 객체
    :param angle: 반시계 방향으로 회전할 각도
    :param expand: 회전 결과를 기존 이미지 크기 내에서 표현 여부
    :return: 회전된 이미지
    """
    return image.rotate(angle, expand=expand)

def resize(image, new_size):
    """
    이미지 크기를 변경하는 함수
    :param image: PIL 이미지 객체
    :param new_size: 새로운 이미지 크기 (width, height)
    :return: 크기가 변경된 이미지
    """
    return image.resize(new_size)

def shearing(image, shear_factor):
    """
    이미지에 전단 변환을 적용하는 함수
    :param image: PIL 이미지 객체
    :param shear_factor: 전단 변환 정도
    :return: 전단 변환된 이미지
    """
    width, height = image.size
    shear_matrix = (1, shear_factor, 0, 0, 1, 0)
    return image.transform((width, height), Image.AFFINE, shear_matrix, resample=Image.BICUBIC)

def main():
    # 이미지 로드
    img = Image.open("path_to_your_image.jpg")
    
    # 작업 1: 이미지 잘라내기
    coordinates = (150, 200, 450, 300)
    cropped_img = crop(img, coordinates)

    # 작업 2: 이미지 회전
    rotated_img = rotate(cropped_img, 160, expand=True)

    # 작업 3: 이미지 크기 변경
    resized_img = resize(rotated_img, (640, 360))

    # 작업 4: 전단 변환 적용
    shear_factor = 0.8
    sheared_img = shearing(resized_img, shear_factor)

    # 결과 이미지 저장
    sheared_img.save("processed_image.jpg")
    print("이미지 처리 완료 및 저장됨: processed_image.jpg")

# 메인 함수 실행
if __name__ == "__main__":
    main()

## 문제2
from PIL import Image, ImageEnhance

def change_brightness(image, factor):
    """
    이미지의 밝기를 변화시키는 함수
    :param image: PIL 이미지 객체
    :param factor: 밝기 변화 비율 (1.0: 원본 밝기, >1.0: 더 밝게, <1.0: 더 어둡게)
    :return: 밝기가 조정된 이미지
    """
    enhancer = ImageEnhance.Brightness(image)
    return enhancer.enhance(factor)

def change_contrast(image, factor):
    """
    이미지의 대조를 변화시키는 함수
    :param image: PIL 이미지 객체
    :param factor: 대조 변화 비율 (1.0: 원본 대조, >1.0: 더 강하게, <1.0: 더 약하게)
    :return: 대조가 조정된 이미지
    """
    enhancer = ImageEnhance.Contrast(image)
    return enhancer.enhance(factor)

def change_grayscale(image):
    """
    이미지를 흑백으로 변환하는 함수
    :param image: PIL 이미지 객체
    :return: 흑백으로 변환된 이미지
    """
    return image.convert("L")

def main():
    # 이미지 로드
    img = Image.open("path_to_your_image.jpg")

    # 작업 1: 이미지를 1.5배 밝게
    brighter_img = change_brightness(img, 1.5)
    brighter_img.save("brightened_image.jpg")
    print("밝기 1.5배 이미지 저장: brightened_image.jpg")

    # 작업 2: 이미지를 0.2배 밝게 (5배 어둡게)
    darker_img = change_brightness(img, 0.2)
    darker_img.save("darkened_image.jpg")
    print("밝기 0.2배 이미지 저장: darkened_image.jpg")

    # 작업 3: 이미지를 3배 대조 강화
    high_contrast_img = change_contrast(img, 3)
    high_contrast_img.save("high_contrast_image.jpg")
    print("대조 3배 강화 이미지 저장: high_contrast_image.jpg")

    # 작업 4: 이미지를 0.1배 대조 약화 (10배 약화)
    low_contrast_img = change_contrast(img, 0.1)
    low_contrast_img.save("low_contrast_image.jpg")
    print("대조 0.1배 이미지 저장: low_contrast_image.jpg")

    # 작업 5: 이미지를 흑백으로 변환
    grayscale_img = change_grayscale(img)
    grayscale_img.save("grayscale_image.jpg")
    print("흑백 이미지 저장: grayscale_image.jpg")

# 메인 함수 실행
if __name__ == "__main__":
    main()

## 문제 3
from PIL import Image, ImageFilter

def sharpening(image, times=1):
    """
    이미지에 샤프닝 필터를 적용하는 함수
    :param image: PIL 이미지 객체
    :param times: 샤프닝 필터 적용 횟수
    :return: 샤프닝 필터가 적용된 이미지
    """
    for _ in range(times):
        image = image.filter(ImageFilter.SHARPEN)
    return image

def blur(image, times=1):
    """
    이미지에 블러 필터를 적용하는 함수
    :param image: PIL 이미지 객체
    :param times: 블러 필터 적용 횟수
    :return: 블러 필터가 적용된 이미지
    """
    for _ in range(times):
        image = image.filter(ImageFilter.BLUR)
    return image

def detect_edge(image):
    """
    이미지에 경계선 탐지 필터를 적용하는 함수
    :param image: PIL 이미지 객체
    :return: 경계선 탐지가 적용된 이미지
    """
    return image.filter(ImageFilter.FIND_EDGES)

def main():
    # 이미지 로드
    img = Image.open("path_to_your_image.jpg")

    # 작업 1: 샤프닝 필터를 1번 적용
    sharpened_once = sharpening(img, times=1)
    sharpened_once.save("sharpened_once.jpg")
    print("샤프닝 1회 적용 이미지 저장: sharpened_once.jpg")

    # 작업 2: 샤프닝 필터를 5번 적용
    sharpened_five_times = sharpening(img, times=5)
    sharpened_five_times.save("sharpened_five_times.jpg")
    print("샤프닝 5회 적용 이미지 저장: sharpened_five_times.jpg")

    # 작업 3: 블러 필터를 1번 적용
    blurred_once = blur(img, times=1)
    blurred_once.save("blurred_once.jpg")
    print("블러 1회 적용 이미지 저장: blurred_once.jpg")

    # 작업 4: 블러 필터를 5번 적용
    blurred_five_times = blur(img, times=5)
    blurred_five_times.save("blurred_five_times.jpg")
    print("블러 5회 적용 이미지 저장: blurred_five_times.jpg")

    # 작업 5: 경계선 탐지
    edge_detected = detect_edge(img)
    edge_detected.save("edge_detected.jpg")
    print("경계선 탐지 이미지 저장: edge_detected.jpg")

# 메인 함수 실행
if __name__ == "__main__":
    main()

## 문제 4
from PIL import Image
import numpy as np

def load_image(path, name):
    """
    경로와 파일명을 통해 이미지를 불러오는 함수
    :param path: 이미지 경로
    :param name: 이미지 파일 이름
    :return: PIL 이미지 객체
    """
    full_path = f"{path}/{name}"
    return Image.open(full_path)

def print_image_size(image):
    """
    PIL 이미지의 크기를 출력하는 함수
    :param image: PIL 이미지 객체
    """
    print(f"PIL Image size: {image.size}")  # (width, height)

def print_numpy_image_info(image):
    """
    numpy 배열의 크기와 픽셀 정보를 출력하는 함수
    :param image: PIL 이미지 객체
    """
    np_img = np.array(image)
    print(f"NumPy Image shape: {np_img.shape}")  # (height, width, channels)
    return np_img

def get_pixel_value(image, np_img, y, x):
    """
    PIL과 numpy로 특정 픽셀의 값을 출력하는 함수
    :param image: PIL 이미지 객체
    :param np_img: numpy 배열로 변환된 이미지
    :param y: 픽셀의 세로 위치
    :param x: 픽셀의 가로 위치
    """
    # PIL에서 픽셀 값 가져오기
    pil_pixel = image.getpixel((x, y))  # (x, y)
    print(f"PIL Pixel value at ({x}, {y}): {pil_pixel}")

    # NumPy에서 픽셀 값 가져오기
    np_pixel = tuple(np_img[y, x])  # (y, x)
    print(f"NumPy Pixel value at ({x}, {y}): {np_pixel}")

def resize_image(image, size):
    """
    PIL 이미지를 주어진 크기로 변경하는 함수
    :param image: PIL 이미지 객체
    :param size: 변경할 크기 (width, height)
    :return: 크기가 변경된 PIL 이미지
    """
    resized_image = image.resize(size)
    print(f"Image resized to: {size}")
    return resized_image

def main():
    # 경로 및 파일 이름
    path = "path_to_your_images"
    name = "example_image.jpg"

    # 이미지 불러오기
    img = load_image(path, name)

    # PIL 이미지 크기 출력
    print_image_size(img)

    # numpy 배열로 변환 후 정보 출력
    np_img = print_numpy_image_info(img)

    # 특정 픽셀 값 확인 (10, 20)
    get_pixel_value(img, np_img, y=10, x=20)

    # 이미지 크기 변경 (224, 224)
    resized_img = resize_image(img, (224, 224))

    # 변경된 이미지 저장
    resized_img.save("resized_image.jpg")
    print("Resized image saved as resized_image.jpg")

if __name__ == "__main__":
    main()

## 문제 5
from tensorflow.keras.preprocessing.image import ImageDataGenerator

def create_generators():
    """
    ImageDataGenerator를 생성하는 함수
    :return: 두 개의 ImageDataGenerator 객체 (정규화하지 않는 것, 정규화하는 것)
    """
    # 정규화를 수행하지 않는 ImageDataGenerator
    non_normalized_gen = ImageDataGenerator()

    # 정규화를 수행하는 ImageDataGenerator
    normalized_gen = ImageDataGenerator(rescale=1/255.0)

    return non_normalized_gen, normalized_gen

def create_train_valid_generators():
    """
    학습용 및 검증용 ImageDataGenerator 생성
    :return: 학습 데이터 generator, 검증 데이터 generator
    """
    # 픽셀 값을 정규화하는 ImageDataGenerator 생성
    train_datagen = ImageDataGenerator(rescale=1/255.0)
    valid_datagen = ImageDataGenerator(rescale=1/255.0)

    # 학습 데이터 준비
    train_set = train_datagen.flow_from_directory(
        'dataset/train',  # 학습 데이터 경로
        target_size=(150, 150),  # 이미지 크기
        batch_size=32,  # 배치 크기
        class_mode='categorical'  # 분류 방식 (예: 'categorical', 'binary')
    )

    # 검증 데이터 준비
    valid_set = valid_datagen.flow_from_directory(
        'dataset/val',  # 검증 데이터 경로
        target_size=(150, 150),  # 이미지 크기
        batch_size=32,  # 배치 크기
        class_mode='categorical'  # 분류 방식
    )

    return train_set, valid_set

def main():
    # 정규화 여부 비교
    non_normalized_gen, normalized_gen = create_generators()
    print("정규화하지 않은 ImageDataGenerator 생성 완료.")
    print("정규화된 ImageDataGenerator 생성 완료.")

    # 학습 및 검증 데이터 준비
    train_set, valid_set = create_train_valid_generators()
    print(f"Train set class indices: {train_set.class_indices}")
    print(f"Validation set class indices: {valid_set.class_indices}")

if __name__ == "__main__":
    main()



