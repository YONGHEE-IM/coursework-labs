## 문제 1

import tensorflow as tf

# fit 함수 완성
def train-model(model, x_train, y_train, x_val, y_val):
    # 학습 설정
    batch_size = 100
    start_epoch = 11
    end_epoch = 20
    shuffle = False

    # 학습 진행
    for epoch in range(start_epoch, end_epoch + 1):
        print(f"Epoch {epoch}/{end_epoch}")

        # 학습 과정
        history = model.fit(
            x_train,
            y_train,
            batch_size = batch_size,
            epochs=1,
            shuffle=shuffle,
            verbose=2,   # 수치 정보만 표시
        )

        # 검증 과정 (5 epoch마다 수행)
        if epoch % 5 == 0:
            val_loss, val_accuracy = model.evaluate(
                x_val,
                y_val,
                batch_size=50,
                steps=10,
                verbose=1
            )
             print(f"Validation Loss: {val_loss:.4f}, Validation Accuracy: {val_accuracy:.4f}")
            
# 사용법 예시
# 모델 정의
model = tf.keras.Sequential([
    tf.keras.layers.Dense(128, activation='relu', input_shape=(input_dim,)),
    tf.keras.layers.Dense(10, activation='softmax')
])
model.compile(optimizer='adam', loss='sparse_categorical_crossentropy', metrics=['accuracy'])

# 데이터 준비
# x_train, y_train, x_val, y_val을 적절히 준비하세요

# 모델 학습 및 검증
train_model(model, x_train, y_train, x_val, y_val)


## 문제 2

# 콜백 클래스 정의
class MyCallback(tf.keras.callbacks.Callback):
   def on_train_begin(self, logs=None):
      # 학습이 시작될 때 호출
      print("Train begin")

    def on_epoch_begin(self, epoch, logs=None):
      # 한 epoch이 시작될 때 호출
      print(f"{epoch}epoch begin")

    def on_epoch_end(self, epoch, logs=None):
      # 한 epoch이 끝날 때 호출
       print(f"{epoch}epoch end")

# 예제 사용법
# 모델 정의
model = tf.keras.Sequential([
    tf.keras.layers.Dense(128, activation='relu', input_shape=(784,)),
    tf.keras.layers.Dense(10, activation='softmax')
])
model.compile(optimizer='adam', loss='sparse_categorical_crossentropy', metrics=['accuracy'])

# 데이터 준비 (예제)
(x_train, y_train), (x_val, y_val) = tf.keras.datasets.mnist.load_data()
x_train, x_val = x_train.reshape(-1, 784) / 255.0, x_val.reshape(-1, 784) / 255.0

# 콜백 인스턴스 생성
my_callback = MyCallback()

# fit 함수에서 콜백 전달
model.fit(
    x_train,
    y_train,
    epochs=5,
    batch_size=100,
    validation_data=(x_val, y_val),
    callbacks=[my_callback]  # 콜백 리스트로 전달
)

## 문제 3
import tensorflow as tf
import os

# 체크포인트 저장 경로 생성
checkpoint_dir = "./chkpnt"
os.makedirs(checkpoint_dir, exist_ok=True)

# EarlyStopping 콜백 설정
cb_earlystop = tf.keras.callbacks.EarlyStopping(
    monitor='val_loss',
    mode='auto',
    verbose=1,
    patience=2
)

# ModelCheckpoint 콜백 설정
cb_chkpnt = tf.keras.callbacks.ModelCheckpoint(
    filepath=os.path.join(checkpoint_dir, "{epoch:04d}.ckpt"),
    monitor='val_loss',
    mode='auto',
    verbose=1,
    save_best_only=True,
    save_weights_only=False,
    save_freq='epoch'
)

# 모델 정의
model = tf.keras.Sequential([
    tf.keras.layers.Dense(128, activation='relu', input_shape=(784,)),
    tf.keras.layers.Dense(10, activation='softmax')
])
model.compile(optimizer='adam', loss='sparse_categorical_crossentropy', metrics=['accuracy'])

# 데이터 준비 (예제)
(x_train, y_train), (x_val, y_val) = tf.keras.datasets.mnist.load_data()
x_train, x_val = x_train.reshape(-1, 784) / 255.0, x_val.reshape(-1, 784) / 255.0

# 학습 실행
model.fit(
    x_train,
    y_train,
    validation_data=(x_val, y_val),
    epochs=20,
    batch_size=100,
    callbacks=[cb_earlystop, cb_chkpnt]  # 콜백 리스트 전달
)

## 문제 4
import tensorflow as tf
import os

# TensorBoard 콜백 정의
log_dir = "logs"
tb = tf.keras.callbacks.TensorBoard(
    log_dir=log_dir,
    histogram_freq=1,  # 에포크마다 히스토그램 계산
    write_graph=True,  # 모델 구조 시각화
    write_images=True  # 가중치 히트맵 저장
)

# 모델 정의 및 컴파일 (스켈레톤 코드로 가정)
model = tf.keras.Sequential([
    tf.keras.layers.Flatten(input_shape=(28, 28)),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])
model.compile(optimizer='adam', loss='sparse_categorical_crossentropy', metrics=['accuracy'])

# 데이터 준비 (스켈레톤 코드로 가정)
(x_train, y_train), (x_test, y_test) = tf.keras.datasets.mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0

# 학습 실행
model.fit(
    x_train,
    y_train,
    epochs=10,
    validation_data=(x_test, y_test),
    callbacks=[tb]  # 텐서보드 콜백 전달
)


